import{r as j,j as u}from"./main-DWMysycb.js";const w=15,W=15,g=5,A=[200,400,2e3,1e4],C=[220,420,2200,2e4],[k,q,M]=X(w,W,g),P={currentMove:0,history:[{squares:Array(w).fill(null).map(n=>Array(W).fill(null)),myWin:Array(k).fill(0),AIWin:Array(k).fill(0),nextPlay:"X"}]};function E(){const[n,t]=j.useReducer(G,P),l=j.useDeferredValue(n),c=j.useCallback((s,a)=>{t({type:"added",nextSquares:s,nextPosition:a})},[t]),y=j.useCallback(s=>{t({type:"changeHistory",historyItem:s,nextPlay:s.winner&&s.winner!=="O"?"O":"X"})},[t]),f=j.useCallback(s=>{t({type:"changeCurrentMove",nextMove:s})},[t]);return u.jsxs("div",{className:"game",children:[u.jsx("div",{className:"game-board",children:u.jsx(N,{history:n.currentMove===l.currentMove?l.history:n.history,currentMove:n.currentMove,onPlay:c,autoPlay:y})}),u.jsx("div",{className:"game-info",children:u.jsx(S,{history:n.currentMove===l.currentMove?l.history:n.history,currentMove:n.currentMove,jumpTo:f})})]})}const S=j.memo(({history:n,currentMove:t,jumpTo:l})=>{const[c,y]=j.useState(!0),f=n[t].nextPlay,s=n.length===1?null:n.map((a,i)=>{let o;if(i===t){if(o=(f==="X"?"Robot":"You")+" are at ",i===0)o+="game start";else{const[r,p]=a.position;o+="move ("+(r+1)+", "+(p+1)+")"}return u.jsx("li",{children:u.jsx("small",{children:o})},i)}else{if(i===0)o="Go to game start";else{const[r,p]=a.position;o="Go to move ("+(r+1)+", "+(p+1)+")"}return u.jsx("li",{children:u.jsx("button",{onClick:()=>l(i),children:o})},i)}});return u.jsxs(u.Fragment,{children:[s&&u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:c,onChange:a=>{y(a.target.checked)}}),c?"Asc":"Desc"]}),s&&c&&u.jsx("ol",{children:s},"moves"),s&&!c&&u.jsx("ol",{reversed:!0,children:s.reverse()},"moves_reverse")]})}),N=j.memo(({history:n,currentMove:t,onPlay:l,autoPlay:c})=>{const y=n[t].squares,f=n[t].line,s=n[t].position,a=n[t].winner,i=n[t].nextPlay,o=a?"Winner: "+a:"Next player: "+i;j.useEffect(()=>{var p=setTimeout(()=>{i==="O"&&c(I(n[t]))});return()=>{clearTimeout(p)}},[n,t,i,c]);function r(p,x){if(a||y[p][x]||i==="O")return;const m=y.map(d=>[...d]);m[p][x]="X",l(m,[p,x])}return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"status",children:o}),y.map((p,x)=>u.jsx("div",{className:"board-row",children:p.map((m,d)=>u.jsx(O,{value:y[d][x],onSquareClick:()=>r(d,x),squareMove:s&&d===s[0]&&x===s[1],lineSucceed:f&&y[d][x]&&f.some(e=>d===e[0]&&x===e[1])},d+x*p.length))},x))]})});function O({value:n,onSquareClick:t,squareMove:l,lineSucceed:c}){return u.jsx("button",{className:"square"+(c?" line":l?" move":""),onClick:t,children:n})}function G(n,t){switch(t.type){case"added":return{currentMove:n.currentMove+1,history:[...n.history.slice(0,n.currentMove+1),{...n.history[n.currentMove],squares:t.nextSquares,position:t.nextPosition,nextPlay:"O"}]};case"changeHistory":return{...n,history:n.history.map((l,c)=>c===n.currentMove?{...l,...t.historyItem,nextPlay:t.nextPlay}:l)};case"changeCurrentMove":return{...n,currentMove:t.nextMove};default:throw Error("Unknown action: "+t.type)}}function I(n){const{squares:t,position:l,myWin:c,AIWin:y}=n,f=t.map(e=>[...e]),[s,a]=l,i=[...c],o=[...y];for(let e=0;e<k;e++)if(q[s][a][e]&&(i[e]++,o[e]=g+1,i[e]===g))return{winner:"X",line:M[e]};let r=f.map(e=>e.map(h=>0)),p=f.map(e=>e.map(h=>0)),x=0,m=0,d=0;for(let e=0;e<f.length;e++)for(let h=0;h<f[e].length;h++)if(!f[e][h]){for(let v=0;v<k;v++)q[e][h][v]&&(i[v]>0&&i[v]<g&&(r[e][h]+=A[i[v]-1]),o[v]>0&&o[v]<g&&(p[e][h]+=C[o[v]-1]));r[e][h]>x?(x=r[e][h],m=e,d=h):r[e][h]===x&&p[e][h]>p[m][d]&&(m=e,d=h),p[e][h]>x?(x=p[e][h],m=e,d=h):p[e][h]===x&&r[e][h]>r[m][d]&&(m=e,d=h)}if(f[m][d])return{winner:"平局"};f[m][d]="O";for(let e=0;e<k;e++)if(q[m][d][e]&&(o[e]++,i[e]=g+1,o[e]===g))return{winner:"O",line:M[e],squares:f,position:[m,d]};return{squares:f,position:[m,d],myWin:i,AIWin:o}}function X(n,t,l){for(var c=[],y=0;y<n;y++){c[y]=[];for(var f=0;f<t;f++)c[y][f]=[]}let s=0,a=[];for(let i=0;i<n;i++)for(let o=0;o<t;o++){if(i<t-(l-1)){a[s]=[];for(let r=0;r<l;r++)c[i+r][o][s]=!0,a[s].push([i+r,o]);s++}if(o<t-(l-1)){a[s]=[];for(let r=0;r<l;r++)c[i][o+r][s]=!0,a[s].push([i,o+r]);s++}if(i<t-(l-1)&&o<t-(l-1)){a[s]=[];for(let r=0;r<l;r++)c[i+r][o+r][s]=!0,a[s].push([i+r,o+r]);s++}if(i<t-(l-1)&&o>l-1-1){a[s]=[];for(let r=0;r<l;r++)c[i+r][o-r][s]=!0,a[s].push([i+r,o-r]);s++}}return[s,c,a]}export{E as default};
